<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR体验</title>
    <script src="./aframe.min.js"></script>
    <script src="./mindar-image-aframe.prod.js"></script>
    <script>
        // 注册look-at组件，实现物体看向目标
        AFRAME.registerComponent('look-at', {
        schema: { type: 'selector' },
        init: function () {},
        tick: function () {
        if (this.data) {
        this.el.object3D.lookAt(this.data.object3D.position);
        }
        }
        });

        // 声音控制函数：点击按钮切换静音状态
        function toggleSound() {
        const video = document.getElementById('asset0');
        video.muted = !video.muted;
        const soundBtn = document.getElementById('soundBtn');
        soundBtn.innerText = video.muted ? '开启声音' : '关闭声音';
        }
    </script>
    <!-- 声音按钮样式：固定在右下角，半透明不遮挡AR画面 -->
    <style>
        #soundBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            touch-action: manipulation;
        }

            #soundBtn:active {
                background: rgba(50, 50, 50, 0.9);
            }
    </style>
</head>
<body>
    <!-- 声音控制按钮，点击即可解锁声音 -->
    <button id="soundBtn" onclick="toggleSound()">开启声音</button>

    <!-- AR场景：优化跟踪参数，减少抖动 -->
    <a-scene mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; maxTrack: 1; detectThreshold: 0.6"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: false">
        <a-assets>
            <!-- 视频资源：保留触屏/点击解锁，配合按钮双重保障 -->
            <video id="asset0"
                   src="./asset0.mp4"
                   alt="AR视频"
                   loop
                   autoplay
                   muted
                   ontouchstart="this.muted = false"
                   onclick="this.muted = false"></video>
        </a-assets>

        <!-- 相机配置：启用射线检测可点击元素 -->
        <a-camera position="0 0 0"
                  look-controls="enabled: false"
                  cursor="fuse: false; rayOrigin: mouse"
                  raycaster="far: 10000; objects: .clickable"
                  id="camera"></a-camera>

        <!-- AR识别目标：绑定识别图索引 -->
        <a-entity mindar-image-target="targetIndex: 0" id="entity0">
            <!-- 视频载体平面：匹配视频比例，添加可点击类 -->
            <a-plane position="0 0 0"
                     rotation="0 0 0"
                     width="1.736"
                     height="0.976"
                     id="plane0"
                     color="#ffffff"
                     src="#asset0"
                     class="clickable"></a-plane>
        </a-entity>
    </a-scene>
</body>
</html>